<!-- snippets/language-switcher.liquid -->
<style>
  .language-switcher {
    position: relative;
    display: inline-block;
    font-family: Arial, sans-serif;
  }
  .language-switcher button {
    display: flex;
    align-items: center;
    background: #000;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 5px 10px;
    cursor: pointer;
  }
  .language-switcher button img {
    margin-right: 8px;
    width: 16px;
    height: 16px;
  }
  .language-switcher ul {
    list-style: none;
    margin: 4px 0 0;
    padding: 0;
    position: absolute;
    left: 0;
    right: 0;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 4px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
  }
  .language-switcher li {
    display: flex;
    align-items: center;
    padding: 8px 10px;
    cursor: pointer;
  }
  .language-switcher li:hover {
    background: #f5f5f5;
  }
  .language-switcher li img {
    margin-right: 8px;
    width: 16px;
    height: 16px;
  }
</style>

<div class="language-switcher" id="language-switcher">
  <button aria-haspopup="listbox" aria-expanded="false" id="lang-toggle">
    <img src="//cdn.gtranslate.net/shopify/assets/flags/16/en.png" alt="English flag" />
    <span id="lang-label">English</span>
  </button>
  <ul role="listbox" id="lang-list" hidden>
    {% assign languages = "af:Afrikaans,sq:Albanian,am:Amharic,ar:Arabic,hy:Armenian,az:Azerbaijani,eu:Basque,be:Belarusian,bn:Bengali,bs:Bosnian,bg:Bulgarian,ca:Catalan,ceb:Cebuano,ny:Chichewa,zh-CN:Chinese (Simplified),zh-TW:Chinese (Traditional),co:Corsican,hr:Croatian,cs:Czech,da:Danish,nl:Dutch,en:English,eo:Esperanto,et:Estonian,tl:Filipino,fi:Finnish,fr:French,fy:Frisian,gl:Galician,ka:Georgian,de:German,el:Greek,gu:Gujarati,ht:Haitian Creole,ha:Hausa,haw:Hawaiian,iw:Hebrew,hi:Hindi,hmn:Hmong,hu:Hungarian,is:Icelandic,ig:Igbo,id:Indonesian,ga:Irish,it:Italian,ja:Japanese,jw:Javanese,kn:Kannada,kk:Kazakh,km:Khmer,ko:Korean,ku:Kurdish (Kurmanji),ky:Kyrgyz,lo:Lao,la:Latin,lv:Latvian,lt:Lithuanian,lb:Luxembourgish,mk:Macedonian,mg:Malagasy,ms:Malay,ml:Malayalam,mt:Maltese,mi:Maori,mr:Marathi,mn:Mongolian,my:Myanmar (Burmese),ne:Nepali,no:Norwegian,ps:Pashto,fa:Persian,pl:Polish,pt:Portuguese,pa:Punjabi,ro:Romanian,ru:Russian,sm:Samoan,gd:Scottish Gaelic,sr:Serbian,st:Sesotho,sn:Shona,sd:Sindhi,si:Sinhala,sk:Slovak,sl:Slovenian,so:Somali,es:Spanish,su:Sudanese,sw:Swahili,sv:Swedish,tg:Tajik,ta:Tamil,te:Telugu,th:Thai,tr:Turkish,uk:Ukrainian,ur:Urdu,uz:Uzbek,vi:Vietnamese,cy:Welsh,xh:Xhosa,yi:Yiddish,yo:Yoruba,zu:Zulu" | split: ',' %}
    {% for lang in languages %}
      {% assign parts = lang | split: ':' %}
      <li role="option" data-lang="{{ parts[0] }}">
        <img src="//cdn.gtranslate.net/shopify/assets/flags/16/{{ parts[0] }}.png" alt="{{ parts[1] }} flag" /> {{ parts[1] }}
      </li>
    {% endfor %}
  </ul>
</div>

<div id="google_translate_element2" style="display:none"></div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('lang-toggle');
    const listbox = document.getElementById('lang-list');
    const label = document.getElementById('lang-label');
    let gtranslateLoaded = false;

    function loadGTranslate() {
      if (gtranslateLoaded) return;
      gtranslateLoaded = true;
      const el = document.createElement('script');
      el.src = '//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit2';
      el.defer = true;
      document.head.appendChild(el);
      const floatJs = document.createElement('script');
      floatJs.src = '//cdn.gtranslate.net/widgets/latest/float.js';
      floatJs.async = true;
      document.head.appendChild(floatJs);
      window.googleTranslateElementInit2 = function() {
        new google.translate.TranslateElement({pageLanguage: 'en', autoDisplay: false}, 'google_translate_element2');
      };
    }

    toggleBtn.addEventListener('click', () => {
      const open = listbox.hidden;
      toggleBtn.setAttribute('aria-expanded', String(open));
      listbox.hidden = !open;
      if (open) loadGTranslate();
    });

    listbox.addEventListener('click', (e) => {
      const opt = e.target.closest('li[role="option"]');
      if (!opt) return;
      const lang = opt.getAttribute('data-lang');
      label.textContent = opt.textContent.trim();
      const img = opt.querySelector('img').cloneNode(true);
      toggleBtn.querySelector('img').replaceWith(img);
      listbox.hidden = true;
      toggleBtn.setAttribute('aria-expanded', 'false');
      if (typeof doGTranslate === 'function') {
        doGTranslate('en|' + lang);
      } else {
        console.error('Translation function not available.');
      }
    });

    document.addEventListener('click', (e) => {
      if (!document.getElementById('language-switcher').contains(e.target)) {
        listbox.hidden = true;
        toggleBtn.setAttribute('aria-expanded', 'false');
      }
    });
  });
</script>

<!-- Usage: {% render 'language-switcher' %} -->
