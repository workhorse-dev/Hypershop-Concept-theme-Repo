<style>
  #shopify-section-{{ section.id }} {
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
    {%- render 'section-variables', section: section -%}
  }

  /* Tabs */
  .custom-tabs {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .tab__item.button--primary {
    pointer-events: none;
    cursor: default;
  }

  /* Panels */
  [role="tabpanel"][hidden] {
    display: none;
  }

  /* Arrows */
  .indicators {
    display: none;
    gap: .5rem;
  }

  .indicators.is-active {
    display: flex;
  }
</style>

<div class="section section--padding{% if section.settings.divider %} section--divider{% endif %}{% if section.settings.rounded %} section--rounded{% endif %}">
  <div class="page-width{% if section.settings.full_width %} page-width--full{% endif %}">
    {%- render 'section-heading', section: section -%}

    {% if section.blocks.size > 0 %}
    <!-- ðŸ”¥ CUSTOM TABS (NO tabs-element) -->
    <div class="custom-tabs" data-tabs role="tablist">
      {% for block in section.blocks %}
        {% assign collection = block.settings.collection %}
        <button
          class="tab__item button{% if forloop.first %} button--primary{% else %} button--secondary{% endif %}"
          type="button"
          role="tab"
          aria-controls="TabPanel-{{ block.id }}"
          data-index="{{ forloop.index0 }}"
        >
          {{ block.settings.title | default: collection.title | escape }}
        </button>
      {% endfor %}
    </div>

    <!-- ARROWS -->
    {% if section.settings.carousel_on_desktop %}
      {% for block in section.blocks %}
        <div class="indicators{% if forloop.first %} is-active{% endif %}" data-index="{{ forloop.index0 }}">
          <button
            class="button button--secondary previous-button"
            type="button"
            aria-controls="Slider-{{ block.id }}"
            disabled
          >
            {%- render 'icon', icon: 'chevron-left' -%}
          </button>

          <button
            class="button button--secondary next-button"
            type="button"
            aria-controls="Slider-{{ block.id }}"
          >
            {%- render 'icon', icon: 'chevron-right' -%}
          </button>
        </div>
      {% endfor %}
    {% endif %}

    <!-- PANELS -->
    {% for block in section.blocks %}
      {% assign collection = block.settings.collection %}
      {% assign products = block.settings.products | default: collection.products %}

      <div
        id="TabPanel-{{ block.id }}"
        role="tabpanel"
        {% unless forloop.first %}hidden{% endunless %}
      >
        <slider-element
          id="Slider-{{ block.id }}"
          class="grid slider{% if section.settings.carousel_on_desktop %} slider--desktop{% endif %}{% if section.settings.swipe_on_mobile %} slider--tablet{% endif %}"
          selector=".card-grid>.card"
        >
          <motion-list class="product-grid card-grid card-grid--{{ section.settings.columns }} mobile:card-grid--{{ section.settings.columns_mobile }}">
            {% for product in products limit: section.settings.product_limit %}
              {%- render 'product-card',
                product: product,
                section_id: section.id,
                block_id: block.id
              -%}
            {% endfor %}
          </motion-list>
        </slider-element>
      </div>
    {% endfor %}
    {% endif %}
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabs = document.querySelectorAll("[data-tabs] [role='tab']");
  const panels = document.querySelectorAll("[role='tabpanel']");
  const indicators = document.querySelectorAll(".indicators");

  function updateArrows(sliderId) {
    const slider = document.getElementById(sliderId);
    if (!slider) return;

    const prev = document.querySelector(`.previous-button[aria-controls="${sliderId}"]`);
    const next = document.querySelector(`.next-button[aria-controls="${sliderId}"]`);
    if (!prev || !next) return;

    prev.disabled = slider.scrollLeft <= 0;
    next.disabled = slider.scrollLeft >= slider.scrollWidth - slider.clientWidth - 2;
  }

  tabs.forEach((tab, index) => {
    tab.addEventListener("click", () => {
      const targetId = tab.getAttribute("aria-controls");
      const sliderId = targetId.replace("TabPanel-", "Slider-");

      // reset tabs
      tabs.forEach(t => {
        t.classList.remove("button--primary");
        t.classList.add("button--secondary");
      });

      // reset panels
      panels.forEach(p => p.hidden = true);

      // reset arrows
      indicators.forEach(i => i.classList.remove("is-active"));

      // activate
      tab.classList.add("button--primary");
      tab.classList.remove("button--secondary");
      document.getElementById(targetId).hidden = false;

      const activeIndicator = document.querySelector(`.indicators[data-index="${index}"]`);
      if (activeIndicator) activeIndicator.classList.add("is-active");

      requestAnimationFrame(() => updateArrows(sliderId));
    });
  });

  // Arrow click
  document.addEventListener("click", e => {
    const btn = e.target.closest(".previous-button, .next-button");
    if (!btn) return;

    const slider = document.getElementById(btn.getAttribute("aria-controls"));
    if (!slider) return;

    slider.scrollBy({
      left: btn.classList.contains("next-button")
        ? slider.clientWidth
        : -slider.clientWidth,
      behavior: "smooth"
    });

    setTimeout(() => updateArrows(slider.id), 300);
  });

  // init first tab
  tabs[0]?.click();
});
</script>
