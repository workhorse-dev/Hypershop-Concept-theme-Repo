<style>
  #shopify-section-{{ section.id }} {
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
    {%- render 'section-variables', section: section -%}
  }

  .custom-tabs {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content:space-between;
  }

  .custom-tabs .tab__item.button--primary {
    pointer-events: none;
    cursor: default;
  }

  .indicators {
    display: none;
    gap: .5rem;
  }

  .indicators.is-active {
    display: flex;
  }
  /* Hover should look like active tab */
#shopify-section-{{ section.id }} .tab__item.button--secondary:hover {
  background: var(--color-button-background, currentColor);
  color: var(--color-button-text, #fff);
}

/* Keep hover consistent (no animation jump) */
#shopify-section-{{ section.id }} .tab__item.button--secondary:hover .btn-fill {
  opacity: 1;
}

/* Active tab stays the same */
#shopify-section-{{ section.id }} .tab__item.button--primary {
  pointer-events: none;
}

</style>

<div class="section section--padding{% if section.settings.divider %} section--divider{% endif %}{% if section.settings.rounded %} section--rounded{% endif %}">
  <div class="page-width{% if section.settings.full_width %} page-width--full{% endif %}">

    {%- render 'section-heading', section: section -%}

    {% if section.blocks.size > 0 %}

      <!-- ✅ TAB BUTTONS -->
      <div class="custom-tabs" data-tabs role="tablist">
        <div>
        {% for block in section.blocks %}
          {% assign collection = block.settings.collection %}
          <button
            class="tab__item button{% if forloop.first %} button--primary{% else %} button--secondary{% endif %}"
            type="button"
            role="tab"
            aria-controls="TabPanel-{{ block.id }}"
            data-index="{{ forloop.index0 }}"
          >
            {{ block.settings.title | default: collection.title | escape }}
          </button>
        {% endfor %}
      </div>
         <!-- ✅ ARROWS -->
      {% if section.settings.carousel_on_desktop %}
        {% for block in section.blocks %}
          <div class="indicators{% if forloop.first %} is-active{% endif %}" data-index="{{ forloop.index0 }}">
            <button
              class="button button--secondary previous-button"
              type="button"
              aria-controls="Slider-{{ block.id }}"
              disabled
            >
              {%- render 'icon', icon: 'chevron-left' -%}
            </button>

            <button
              class="button button--secondary next-button"
              type="button"
              aria-controls="Slider-{{ block.id }}"
            >
              {%- render 'icon', icon: 'chevron-right' -%}
            </button>
          </div>
        {% endfor %}
      {% endif %}
      </div>

     

      <!-- ✅ PANELS -->
      {% for block in section.blocks %}
        {% assign collection = block.settings.collection %}
        {% assign products = block.settings.products | default: collection.products %}

        <div
          id="TabPanel-{{ block.id }}"
          role="tabpanel"
          {% unless forloop.first %}hidden{% endunless %}
        >
          <slider-element
            id="Slider-{{ block.id }}"
            class="grid slider{% if section.settings.carousel_on_desktop %} slider--desktop{% endif %}{% if section.settings.swipe_on_mobile %} slider--tablet{% endif %}"
            selector=".card-grid>.card"
          >
            <motion-list class="product-grid card-grid card-grid--{{ section.settings.columns }} mobile:card-grid--{{ section.settings.columns_mobile }} grid">
              {% for product in products limit: section.settings.product_limit %}
                {%- render 'product-card',
                  product: product,
                  section_id: section.id,
                  block_id: block.id
                -%}
              {% endfor %}
            </motion-list>
          </slider-element>
        </div>
      {% endfor %}

    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "t:sections.featured-collections.name",
  "class": "featured-collections",
  "max_blocks": 6,
  "settings": [
    {
      "type": "range",
      "id": "product_limit",
      "label": "t:sections.global.settings.product_limit.label",
      "default": 6,
      "min": 2,
      "max": 12,
      "step": 1
    },
    {
      "type": "range",
      "id": "columns",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "t:sections.global.settings.columns.label"
    },
    {
      "type": "checkbox",
      "id": "carousel_on_desktop",
      "label": "t:sections.global.settings.carousel_on_desktop.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "t:sections.featured-collection.settings.show_view_all.label",
      "info": "t:sections.featured-collection.settings.show_view_all.info",
      "default": false
    },
    {
      "type": "header",
      "content": "t:sections.global.settings.header__mobile.content"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "options": [
        {
          "value": "1",
          "label": "t:sections.global.settings.columns_mobile.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.global.settings.columns_mobile.options__2.label"
        }
      ],
      "default": "1",
      "label": "t:sections.global.settings.columns_mobile.label"
    },
    {
      "type": "checkbox",
      "id": "swipe_on_mobile",
      "label": "t:sections.global.settings.swipe_on_mobile.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.global.settings.header__heading.content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "label": "t:sections.global.settings.heading.label",
      "default": "Featured collection"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "title-sm",
          "label": "t:sections.global.settings.heading_size.options__1.label"
        },
        {
          "value": "title-md",
          "label": "t:sections.global.settings.heading_size.options__2.label"
        },
        {
          "value": "title-lg tracking-heading",
          "label": "t:sections.global.settings.heading_size.options__3.label"
        },
        {
          "value": "title-xl tracking-heading",
          "label": "t:sections.global.settings.heading_size.options__4.label"
        }
      ],
      "default": "title-md",
      "label": "t:sections.global.settings.heading_size.label"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "t:sections.global.settings.heading_alignment.label",
      "options": [
        {
          "value": "text-left md:items-end md:flex-row",
          "label": "t:sections.global.settings.heading_alignment.options__1.label"
        },
        {
          "value": "text-center md:items-center",
          "label": "t:sections.global.settings.heading_alignment.options__2.label"
        },
        {
          "value": "text-right md:items-end md:flex-row-reverse",
          "label": "t:sections.global.settings.heading_alignment.options__3.label"
        }
      ],
      "default": "text-left md:items-end md:flex-row"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "options": [
        {
          "value": "h1",
          "label": "t:sections.global.settings.heading_tag.options__1.label"
        },
        {
          "value": "h2",
          "label": "t:sections.global.settings.heading_tag.options__2.label"
        },
        {
          "value": "h3",
          "label": "t:sections.global.settings.heading_tag.options__3.label"
        },
        {
          "value": "h4",
          "label": "t:sections.global.settings.heading_tag.options__4.label"
        },
        {
          "value": "h5",
          "label": "t:sections.global.settings.heading_tag.options__5.label"
        },
        {
          "value": "h6",
          "label": "t:sections.global.settings.heading_tag.options__6.label"
        },
        {
          "value": "div",
          "label": "t:sections.global.settings.heading_tag.options__7.label"
        },
        {
          "value": "span",
          "label": "t:sections.global.settings.heading_tag.options__8.label"
        },
        {
          "value": "p",
          "label": "t:sections.global.settings.heading_tag.options__9.label"
        }
      ],
      "default": "h2",
      "label": "t:sections.global.settings.heading_tag.label",
      "info": "t:sections.global.settings.heading_tag.info"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:sections.global.settings.subheading.label"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "t:sections.global.settings.description.label"
    },
    {
      "type": "header",
      "content": "t:sections.global.settings.header__highlight.content",
      "info": "t:sections.global.settings.header__highlight.info"
    },
    {
      "type": "select",
      "id": "highlighted_text",
      "options": [
        {
          "value": "none",
          "label": "t:sections.global.settings.highlighted_text.options__1.label"
        },
        {
          "value": "text",
          "label": "t:sections.global.settings.highlighted_text.options__2.label"
        },
        {
          "value": "full_text",
          "label": "t:sections.global.settings.highlighted_text.options__3.label"
        },
        {
          "value": "half_text",
          "label": "t:sections.global.settings.highlighted_text.options__4.label"
        },
        {
          "value": "underline",
          "label": "t:sections.global.settings.highlighted_text.options__5.label"
        },
        {
          "value": "stencil",
          "label": "t:sections.global.settings.highlighted_text.options__6.label"
        },
        {
          "value": "scribble",
          "label": "t:sections.global.settings.highlighted_text.options__7.label"
        }
      ],
      "default": "none",
      "label": "t:sections.global.settings.highlighted_text.label"
    },
    {
      "type": "select",
      "id": "highlighted_scribble",
      "options": [
        {
          "value": "circle",
          "label": "t:sections.global.settings.highlighted_scribble.options__1.label"
        },
        {
          "value": "basic-underline",
          "label": "t:sections.global.settings.highlighted_scribble.options__2.label"
        },
        {
          "value": "sketch-underline",
          "label": "t:sections.global.settings.highlighted_scribble.options__3.label"
        },
        {
          "value": "squiggle-underline",
          "label": "t:sections.global.settings.highlighted_scribble.options__4.label"
        },
        {
          "value": "squiggle-underline-2",
          "label": "t:sections.global.settings.highlighted_scribble.options__5.label"
        }
      ],
      "default": "circle",
      "label": "t:sections.global.settings.highlighted_scribble.label",
      "info": "t:sections.global.settings.highlighted_scribble.info"
    },
    {
      "type": "header",
      "content": "t:sections.global.settings.header__colors.content",
      "info": "t:sections.global.settings.header__colors.info"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "t:sections.global.settings.color_text.label"
    },
    {
      "type": "color",
      "id": "color_background",
      "label": "t:sections.global.settings.color_background.label"
    },
    {
      "type": "color_background",
      "id": "gradient_background",
      "label": "t:sections.global.settings.gradient_background.label"
    },
    {
      "type": "color",
      "id": "color_highlight",
      "label": "t:sections.global.settings.color_highlight.label"
    },
    {
      "type": "color_background",
      "id": "gradient_highlight",
      "label": "t:sections.global.settings.gradient_highlight.label"
    },
    {
      "type": "color",
      "id": "color_button_text",
      "label": "t:sections.global.settings.color_button_text.label"
    },
    {
      "type": "color",
      "id": "color_button_background",
      "label": "t:sections.global.settings.color_button_background.label"
    },
    {
      "type": "color_background",
      "id": "color_button_gradient",
      "label": "t:sections.global.settings.color_button_gradient.label"
    },
    {
      "type": "header",
      "content": "t:sections.global.settings.header__section.content"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.global.settings.padding_top.label",
      "default": 72
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.global.settings.padding_bottom.label",
      "default": 72
    },
    {
      "type": "checkbox",
      "id": "divider",
      "label": "t:sections.global.settings.divider.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "t:sections.global.settings.full_width.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "rounded",
      "default": false,
      "label": "t:sections.global.settings.rounded.label"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "t:sections.global.blocks.collection.name",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "t:sections.global.settings.collection.label"
        },
        {
          "type": "product_list",
          "id": "products",
          "label": "t:sections.global.settings.products.label",
          "info": "t:sections.global.settings.products.info"
        },
        {
          "type": "text",
          "id": "title",
          "label": "t:sections.global.settings.title.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.featured-collections.presets.name",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ],
  "disabled_on": {
    "templates": [
      "password"
    ]
  }
}
{% endschema %}
{% comment %} <script>
document.addEventListener("DOMContentLoaded", () => {
  const tabs = document.querySelectorAll('[role="tab"]');
  const panels = document.querySelectorAll('[role="tabpanel"]');
  const indicators = document.querySelectorAll('.indicators');

   function updateArrows(sliderId) {
    const slider = document.getElementById(sliderId);
    if (!slider) return;

    const prevBtn = document.querySelector(
      `.previous-button[aria-controls="${sliderId}"]`
    );
    const nextBtn = document.querySelector(
      `.next-button[aria-controls="${sliderId}"]`
    );

    if (!prevBtn || !nextBtn) return;

    const scrollLeft = slider.scrollLeft;
    const maxScroll = slider.scrollWidth - slider.clientWidth;

    prevBtn.disabled = scrollLeft <= 0;
    nextBtn.disabled = scrollLeft >= maxScroll - 5;
  } 


  tabs.forEach((tab, index) => {
    tab.addEventListener("click", () => {
      const targetId = tab.getAttribute("aria-controls");
      const sliderId = targetId.replace("TabPanel-", "Slider-");

      /* Tabs reset */
      tabs.forEach(t => {
        t.classList.remove("button--primary");
        t.classList.add("button--secondary");
        t.disabled = false;
      });

      /* Panels reset */
      panels.forEach(p => (p.hidden = true));

      /* Indicators reset */
      {% comment %} indicators.forEach(i => i.classList.add("hidden")); {% endcomment %}

      /* Activate tab */
      tab.classList.add("button--primary");
      tab.classList.remove("button--secondary");
      tab.disabled = true;

      /* Show panel */
      const panel = document.getElementById(targetId);
      if (panel) panel.hidden = false;

      /* Show correct arrows */
      {% comment %} const indicator = document.querySelector(
        `.indicators[data-index="${index}"]`
      );
      if (indicator) indicator.classList.remove("hidden"); {% endcomment %}
      /* HARD RESET: hide all arrows */
/* HARD RESET */
/* HARD RESET */
indicators.forEach(i => {
  i.classList.remove("is-active");
});

/* Show ONLY current tab arrows */
const indicator = document.querySelector(
  `.indicators[data-index="${index}"]`
);

if (indicator) {
  indicator.classList.add("is-active");
}




      /* Update arrows state */
      requestAnimationFrame(() => updateArrows(sliderId));
    });
  });

  /* Bind arrow clicks */
  document.addEventListener("click", e => {
    const btn = e.target.closest(".previous-button, .next-button");
    if (!btn) return;

    const sliderId = btn.getAttribute("aria-controls");
    const slider = document.getElementById(sliderId);
    if (!slider) return;

    const scrollAmount = slider.clientWidth;

    slider.scrollBy({
      left: btn.classList.contains("next-button")
        ? scrollAmount
        : -scrollAmount,
      behavior: "smooth"
    }); 
 


    setTimeout(() => updateArrows(sliderId), 300);
  });
 //  INITIAL LOAD: activate first tab arrows
requestAnimationFrame(() => {
  const firstTab = document.querySelector('[role="tab"]');
  if (firstTab) {
    firstTab.dispatchEvent(new Event('click'));
  }
});


});
</script> {% endcomment %}


<script>
document.addEventListener("DOMContentLoaded", () => {
  const section = document.getElementById("shopify-section-{{ section.id }}");
  if (!section) return;

  const tabs = section.querySelectorAll('[role="tab"]');
  const panels = section.querySelectorAll('[role="tabpanel"]');
  const indicators = section.querySelectorAll('.indicators');

  function updateArrows(sliderId) {
    const slider = document.getElementById(sliderId);
    if (!slider) return;

    const prev = section.querySelector(`.previous-button[aria-controls="${sliderId}"]`);
    const next = section.querySelector(`.next-button[aria-controls="${sliderId}"]`);

    if (!prev || !next) return;

    prev.disabled = slider.scrollLeft <= 0;
    next.disabled = slider.scrollLeft >= slider.scrollWidth - slider.clientWidth - 2;
  }

  tabs.forEach((tab, index) => {
    tab.addEventListener("click", () => {
      const panelId = tab.getAttribute("aria-controls");
      const sliderId = panelId.replace("TabPanel-", "Slider-");

      // reset tabs
      tabs.forEach(t => {
        t.classList.remove("button--primary");
        t.classList.add("button--secondary");
      });

      // reset panels
      panels.forEach(p => p.hidden = true);

      // reset arrows
      indicators.forEach(i => i.classList.remove("is-active"));

      // activate
      tab.classList.add("button--primary");
      tab.classList.remove("button--secondary");
      section.querySelector(`#${panelId}`).hidden = false;

      const activeIndicator = section.querySelector(`.indicators[data-index="${index}"]`);
      if (activeIndicator) activeIndicator.classList.add("is-active");

      requestAnimationFrame(() => updateArrows(sliderId));
    });
  });

  // Arrow click
  section.addEventListener("click", e => {
    const btn = e.target.closest(".previous-button, .next-button");
    if (!btn) return;

    const slider = document.getElementById(btn.getAttribute("aria-controls"));
    if (!slider) return;

    slider.scrollBy({
      left: btn.classList.contains("next-button")
        ? slider.clientWidth
        : -slider.clientWidth,
      behavior: "smooth"
    });

    setTimeout(() => updateArrows(slider.id), 300);
  });

  // init
  if (tabs[0]) tabs[0].click();
});
</script>
